[phases.setup]
nixPkgs = ["php82", "php82Packages.composer", "nodejs_20", "nginx"]

[phases.install]
cmds = [
    "composer install --no-dev --optimize-autoloader"
]

[phases.build]
cmds = [
    "npm ci",
    "npm run build",
    "php artisan migrate --force",
    "php artisan config:cache",
    "php artisan route:cache",
    "php artisan view:clear",
    "php artisan view:cache"
]

[start]
cmd = "php -S 0.0.0.0:$PORT -t public/"

[variables]
APP_ENV = "production"
APP_DEBUG = "false"
APP_URL = "https://pura-vida-rides-production.up.railway.app"
APP_KEY = "base64:q2Hze5dfTzap+gT74GvoVypFt8MQD+UAxUd3CHq0bDA="
DB_CONNECTION = "sqlite"
DB_DATABASE = "/app/database/database.sqlite"
SESSION_DRIVER = "file"
CACHE_STORE = "file"
QUEUE_CONNECTION = "sync"